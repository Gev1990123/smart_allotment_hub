<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Smart Allotment Dashboard</title>

    <!-- CSS -->
    <link rel="stylesheet" href="/static/css/styles.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">



</head>

<body>

<header>
    <h1>ğŸŒ± Smart Allotment Dashboard</h1>
</header>

<!-- NAVIGATION -->
<nav>
    <div class="nav-links">
        <a href="/" class="active">ğŸ“Š Dashboard</a>
        <a href="/devices">ğŸ“¡ Devices</a>
        <a href="/sites">ğŸ¡ Sites</a>
        <a href="/sensors">ğŸ”§ Sensors</a>
        {% if user.role == 'sys_admin' %}
        <a href="/users">ğŸ‘¤ Users</a>
        {% endif %}
    </div>
    <div class="nav-user">
        <span class="user-info">
            <strong>{{ user.full_name or user.username }}</strong>
            {% if user.role == 'sys_admin' %}
            <span class="user-role-badge">Admin</span>
            {% endif %}
        </span>
        <button onclick="logout()" class="btn-secondary">Logout</button>
    </div>  
</nav>

<main>

    <!-- Device Picker -->
    <div class="page-selector">
        <label for="deviceSelect"><strong>Select Device:</strong></label>
        <select id="deviceSelect"></select>
    </div>

    <!-- Latest Reading Summary -->
    <div class="sensor-grid">
        <div class="sensor-card" data-type="temperature">
            <div class="sensor-icon">ğŸŒ¡ï¸</div>
            <div class="sensor-value" id="tempValue">--</div>
            <div class="sensor-label">Temperature</div>
            <div class="sensor-unit">Â°C</div>
        </div>
        <div class="sensor-card" data-type="moisture">
            <div class="sensor-icon">ğŸ’§</div>
            <div class="sensor-value" id="moistureValue">--</div>
            <div class="sensor-label">Soil Moisture</div>
            <div class="sensor-unit">%</div>
        </div>
        <div class="sensor-card" data-type="light">
            <div class="sensor-icon">â˜€ï¸</div>
            <div class="sensor-value" id="lightValue">--</div>
            <div class="sensor-label">Light</div>
            <div class="sensor-unit">lux</div>
        </div>
        <div class="sensor-card status">
            <div class="sensor-icon">ğŸ“¡</div>
            <div class="sensor-value" id="statusValue">Offline</div>
            <div class="sensor-label">Status</div>
            <div class="sensor-unit"></div>
        </div>
    </div>

   <!-- Time Range Control -->
    <div class="time-control-bar">
        <div class="section-title">ğŸ“… History Time Range</div>

        <!-- Quick presets -->
        <div class="preset-group">
            <label>Quick:</label>
            <button class="preset-btn active" data-hours="1">1h</button>
            <button class="preset-btn" data-hours="2">2h</button>
            <button class="preset-btn" data-hours="6">6h</button>
            <button class="preset-btn" data-hours="12">12h</button>
            <button class="preset-btn" data-hours="24">24h</button>
            <button class="preset-btn" data-hours="48">48h</button>
            <button class="preset-btn" data-hours="168">7d</button>
            <button class="preset-btn" data-hours="720">30d</button>
        </div>

        <div class="tc-divider"></div>

        <!-- Custom date range -->
        <div class="custom-range-group">
            <label>Custom:</label>
            <div class="datetime-field">
                <span>From</span>
                <input type="datetime-local" id="rangeFrom" />
            </div>
            <div class="datetime-field">
                <span>To</span>
                <input type="datetime-local" id="rangeTo" />
            </div>
            <button class="apply-btn" id="applyRangeBtn">Apply Range</button>
        </div>

        <!-- Active range display -->
        <div class="active-range-label" id="activeRangeLabel">
            Showing: <strong>last 1 hour</strong>
        </div>
    </div>

    <!-- Chart Area -->
    <div class="charts-grid">
        <div class="chart-container">
            <h3>ğŸŒ¡ï¸ Temperature (Â°C)</h3>
            <p class="chart-meta" id="tempMeta"></p>
            <div class="chart-wrapper">
                <canvas id="tempChart"></canvas>
                <div class="chart-loading" id="tempLoading"><div class="spinner"></div> Loadingâ€¦</div>
                <div class="no-data-msg" id="tempNoData"><div class="no-data-icon">ğŸŒ¡ï¸</div>No temperature data in range</div>
            </div>
        </div>
        <div class="chart-container">
            <h3>ğŸ’§ Moisture (%)</h3>
            <p class="chart-meta" id="moistureMeta"></p>
            <div class="chart-wrapper">
                <canvas id="moistureChart"></canvas>
                <div class="chart-loading" id="moistureLoading"><div class="spinner"></div> Loadingâ€¦</div>
                <div class="no-data-msg" id="moistureNoData"><div class="no-data-icon">ğŸ’§</div>No moisture data in range</div>
            </div>
        </div>
        <div class="chart-container">
            <h3>â˜€ï¸ Light (lux)</h3>
            <p class="chart-meta" id="lightMeta"></p>
            <div class="chart-wrapper">
                <canvas id="lightChart"></canvas>
                <div class="chart-loading" id="lightLoading"><div class="spinner"></div> Loadingâ€¦</div>
                <div class="no-data-msg" id="lightNoData"><div class="no-data-icon">â˜€ï¸</div>No light data in range</div>
            </div>
        </div>
    </div>

</main>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

    <!-- Shared Scripts -->
    <script src="/static/js/scripts.js"></script>
    <script src="/static/js/dashboard.js"></script>

</body>
</html>